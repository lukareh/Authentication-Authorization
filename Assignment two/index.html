<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JWT Authentication System</title>
</head>
<body>
    <h1>JWT Authentication System</h1>
    
    <h2>1. Register User</h2>
    <form id="registerForm">
        <label for="username">Username:</label>
        <input type="text" id="username" name="username" required>
        <br><br>
        
        <label for="role">Role:</label>
        <input type="text" id="role" name="role" placeholder="e.g., admin, user, manager" required>
        <br><br>
        
        <label for="designation">Designation:</label>
        <input type="text" id="designation" name="designation" placeholder="e.g., Software Engineer" required>
        <br><br>
        
        <label for="age">Age:</label>
        <input type="number" id="age" name="age" min="1" required>
        <br><br>
        
        <button type="submit">Register User</button>
    </form>
    <div id="registerResult"></div>

    <hr>

    <h2>2. Generate JWT Token</h2>
    <form id="generateForm">
        <label for="genUsername">Username:</label>
        <input type="text" id="genUsername" name="genUsername" required>
        <button type="submit">Generate Token</button>
    </form>
    <div id="generateResult"></div>

    <hr>

    <h2>3. Validate JWT Token</h2>
    <form id="validateForm">
        <label for="token">Token:</label>
        <textarea id="token" name="token" rows="4" cols="50" required></textarea>
        <br>
        <button type="submit">Validate Token</button>
    </form>
    <div id="validateResult"></div>

    <script>
        // Register User
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const role = document.getElementById('role').value;
            const designation = document.getElementById('designation').value;
            const age = parseInt(document.getElementById('age').value);
            const resultDiv = document.getElementById('registerResult');
            
            try {
                const response = await fetch('http://localhost:8080/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        username: username,
                        role: role,
                        designation: designation,
                        age: age
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = '<h3 style="color: green;">User Registered Successfully!</h3>' +
                        '<p><strong>Username:</strong> ' + username + '</p>' +
                        '<p><strong>Role:</strong> ' + role + '</p>' +
                        '<p><strong>Designation:</strong> ' + designation + '</p>' +
                        '<p><strong>Age:</strong> ' + age + '</p>' +
                        '<p>You can now generate a token using this username.</p>';
                    document.getElementById('registerForm').reset();
                } else {
                    resultDiv.innerHTML = '<p style="color: red;">Error: ' + (data.error || JSON.stringify(data)) + '</p>';
                }
            } catch (error) {
                resultDiv.innerHTML = '<p style="color: red;">Error: ' + error.message + '</p>';
            }
        });

        // Generate Token
        document.getElementById('generateForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const username = document.getElementById('genUsername').value;
            const resultDiv = document.getElementById('generateResult');
            
            try {
                const response = await fetch('http://localhost:8080/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ username: username })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = '<h3>Token Generated Successfully!</h3>' +
                        '<p><strong>Token:</strong></p>' +
                        '<textarea rows="4" cols="80" readonly>' + data.token + '</textarea>' +
                        '<p><strong>Username:</strong> ' + username + '</p>' +
                        '<p><strong>Expiry:</strong> 5 minutes</p>';
                } else {
                    resultDiv.innerHTML = '<p style="color: red;">Error: ' + (data.error || JSON.stringify(data)) + '</p>';
                }
            } catch (error) {
                resultDiv.innerHTML = '<p style="color: red;">Error: ' + error.message + '</p>';
            }
        });

        // Validate Token
        document.getElementById('validateForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const token = document.getElementById('token').value;
            const resultDiv = document.getElementById('validateResult');
            
            try {
                const response = await fetch('http://localhost:8080/validate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ token: token })
                });
                
                const data = await response.json();
                
                if (data.valid) {
                    resultDiv.innerHTML = '<h3 style="color: green;">Token Valid ✓</h3>' +
                        '<p><strong>Message:</strong> ' + data.message + '</p>' +
                        '<p><strong>Decoded Claims:</strong></p>' +
                        '<pre>' + JSON.stringify(data.claims, null, 2) + '</pre>' +
                        '<p><strong>Username:</strong> ' + data.claims.username + '</p>' +
                        '<p><strong>Role:</strong> ' + data.claims.role + '</p>' +
                        '<p><strong>Designation:</strong> ' + data.claims.designation + '</p>' +
                        '<p><strong>Age:</strong> ' + data.claims.age + '</p>';
                } else {
                    resultDiv.innerHTML = '<h3 style="color: red;">Token Invalid ✗</h3>' +
                        '<p><strong>Message:</strong> ' + data.message + '</p>';
                }
            } catch (error) {
                resultDiv.innerHTML = '<p style="color: red;">Error: ' + error.message + '</p>';
            }
        });
    </script>
</body>
</html>
